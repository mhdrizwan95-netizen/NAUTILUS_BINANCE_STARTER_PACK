groups:
- name: hmm-alerts
  rules:
  - alert: KillSwitchOn
    expr: state_active == 0 and absent_over_time(state_active[2m]) == 0
    for: 2m
    annotations: { description: "Strategy appears inactive (possible kill switch or stall)." }

  - alert: DriftHigh
    expr: drift_score > 0.5
    for: 5m
    annotations: { description: "Feature drift sustained above threshold." }

  - alert: GuardrailStorm
    expr: sum(rate(guardrail_trigger_total[5m])) > 30
    for: 2m
    annotations: { description: "Guardrails triggering excessively." }

  - alert: VenueSpecsStale
    expr: time() - last_specs_refresh_epoch > 172800
    for: 5m
    labels: {severity: warn}
    annotations:
      summary: "Venue specs stale"
      description: "Lot-size/filters not refreshed in over 48 hours."

  - alert: IBKRPriceFeedStale
    expr: time() - ibkr_last_price_update_epoch > 120
    for: 2m
    labels: {severity: warn}
    annotations:
      summary: "IBKR price feed stale"
      description: "No price update from IBKR in >2 minutes."

  - alert: ExposureCollectorStale
    expr: time() - ops_exposure_last_refresh_epoch > 120
    for: 2m
    labels: {severity: warn}
    annotations:
      summary: "Exposure collector stale"
      description: "OPS has not refreshed exposure metrics for >2 minutes."

  - alert: SymbolExposureHigh
    expr: exposure_usd > 10000
    for: 1m
    labels: {severity: warn}
    annotations:
      summary: "High exposure"
      description: "{{ $labels.symbol }} exposure exceeds $10k"

  - alert: TradingDisabledTooLong
    expr: max(trading_enabled) == 0
    for: 5m
    labels: {severity: warn}
    annotations:
      summary: "Trading disabled > 5m"
      description: "trading_enabled gauge is 0 for 5 minutes."
