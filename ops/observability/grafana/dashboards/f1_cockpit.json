{
  "uid": "f1-cockpit",
  "title": "F1 Cockpit — Trading Mission Control",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "tags": ["trading", "ops", "f1"],
  "templating": {
    "list": [
      {
        "name": "instance",
        "type": "query",
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "query": "label_values(up, instance)",
        "includeAll": true,
        "multi": true
      },
      {
        "name": "symbol",
        "type": "query",
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "query": "label_values(exposure_by_symbol, symbol)",
        "includeAll": true,
        "multi": true
      }
    ]
  },
  "time": {"from": "now-6h", "to": "now"},
  "refresh": "10s",
  "graphTooltip": 1,
  "panels": [
    {"type":"stat","title":"Equity (USD)","gridPos":{"x":0,"y":0,"w":6,"h":3},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"portfolio_equity_usd_total"}],
     "fieldConfig":{"defaults":{"unit":"currencyUSD","decimals":2},"overrides":[]},
     "options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["last"],"values":false}}},

    {"type":"stat","title":"PnL Realized (USD)","gridPos":{"x":6,"y":0,"w":4,"h":3},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"sum without (pid, instance, job) (pnl_realized_total)"}],
     "fieldConfig":{"defaults":{"unit":"currencyUSD","decimals":2},"overrides":[]},
     "options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["last"],"values":false}}},

    {"type":"stat","title":"PnL Unrealized (USD)","gridPos":{"x":10,"y":0,"w":4,"h":3},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"sum without (pid, instance, job) (pnl_unrealized_total)"}],
     "fieldConfig":{"defaults":{"unit":"currencyUSD","decimals":2},"overrides":[]},
     "options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["last"],"values":false}}},

    {"type":"gauge","title":"Incident Load (5m)","gridPos":{"x":14,"y":0,"w":10,"h":3},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"incidents_5m"}],
     "fieldConfig":{"defaults":{"min":0,"max":10,
       "thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"yellow","value":1},{"color":"red","value":3}]}}],
     "options":{"showThresholdLabels":false,"showThresholdMarkers":true}},

    {"type":"timeseries","title":"PnL (Total)","gridPos":{"x":0,"y":3,"w":12,"h":7},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[
       {"expr":"pnl_total_usd","legendFormat":"Total"},
       {"expr":"sum without (pid, instance, job) (pnl_realized_total)","legendFormat":"Realized"},
       {"expr":"sum without (pid, instance, job) (pnl_unrealized_total)","legendFormat":"Unrealized"}
     ],
     "fieldConfig":{"defaults":{"unit":"currencyUSD"}},
     "options":{"legend":{"displayMode":"list","placement":"bottom"}}},

    {"type":"timeseries","title":"Orders — Submitted vs Filled (15m)","gridPos":{"x":12,"y":3,"w":12,"h":7},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[
       {"expr":"orders_submitted_15m","legendFormat":"Submitted"},
       {"expr":"orders_filled_15m","legendFormat":"Filled"},
       {"expr":"fills_success_rate_15m","legendFormat":"Fill Rate"}
     ],
     "fieldConfig":{"defaults":{"unit":"short"}},
     "options":{"legend":{"displayMode":"list","placement":"bottom"}}},

    {"type":"bargauge","title":"Exposure by Symbol","gridPos":{"x":0,"y":10,"w":10,"h":7},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"exposure_by_symbol{symbol=~\"$symbol\"}"}],
     "fieldConfig":{"defaults":{"unit":"currencyUSD"}},
     "options":{"displayMode":"gradient"}},

    {"type":"stat","title":"Active Positions","gridPos":{"x":10,"y":10,"w":4,"h":7},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"count(exposure_by_symbol unless exposure_by_symbol==0)"}],
     "options":{"colorMode":"background","graphMode":"none","reduceOptions":{"calcs":["last"],"values":false}}},

    {"type":"timeseries","title":"Engine Health — WS Disconnects & p99 Submit→Ack","gridPos":{"x":14,"y":10,"w":10,"h":7},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[
       {"expr":"ws_disconnects_15m","legendFormat":"WS Disconnects"},
       {"expr":"histogram_quantile(0.99, trading:submit_to_ack_ms:rate5m_by_le)","legendFormat":"p99 Submit→Ack (ms)"}
     ],
     "fieldConfig":{"overrides":[{"matcher":{"id":"byName","options":"p99 Submit→Ack (ms)"},"properties":[{"id":"unit","value":"ms"}]}]},
     "options":{"legend":{"displayMode":"list","placement":"bottom"}}},

    {"type":"timeseries","title":"Model State — Drift / Entropy","gridPos":{"x":0,"y":17,"w":12,"h":6},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"model_drift_score","legendFormat":"Drift"},{"expr":"model_entropy","legendFormat":"Entropy"}]},

    {"type":"table","title":"Event Ticker (Incidents last 1h)","gridPos":{"x":12,"y":17,"w":12,"h":6},
     "datasource":{"type":"prometheus","uid":"prometheus"},
     "targets":[{"expr":"increase(m20_incidents_total[1h])"}],
     "options":{"showHeader":true}}
  ],
  "annotations": {"list": [{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]}
}
