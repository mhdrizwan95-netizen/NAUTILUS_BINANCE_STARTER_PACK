# Alert Rules Configuration - M14 Real-Time Alerting & Anomaly Detection
# Each rule subscribes to an event bus topic and evaluates conditions
# When conditions are met, formatted messages are sent via configured channels

# Operational Alerts - Core Trading Events
- topic: order.submitted
  condition: "data.get('symbol', '').endswith('BTCUSDT.BINANCE')"
  message: "üõí BTC trade submitted: {side} {quote:.2f} USDT @ {symbol}"
  channels: ["log", "telegram"]

- topic: order.closed
  condition: "data.get('status') == 'FILLED'"
  message: "‚úÖ {symbol} {side} filled @ {avg_fill_price:.2f} (qty: {filled_qty:.6f})"
  channels: ["log", "telegram"]

- topic: order.closed
  condition: "data.get('status') == 'CANCELED'"
  message: "‚õî {symbol} canceled - {venue_order_id}"
  channels: ["log"]

# Risk & Safety Alerts - Critical Threshold Breaches
- topic: risk.rejected
  condition: "data.get('reason') == 'MIN_NOTIONAL'"
  message: "‚ùó RISK: Order below min notional ({quote:.2f} USDT) - {symbol}"
  channels: ["log", "telegram"]
  priority: "high"

- topic: risk.rejected
  condition: "data.get('reason') == 'EXPOSURE_LIMIT'"
  message: "‚ö†Ô∏è RISK: Exposure limit exceeded - {symbol} {quote:.2f} USDT"
  channels: ["log", "telegram"]
  priority: "high"

- topic: risk.rejected
  condition: "data.get('reason') == 'TRADING_DISABLED'"
  message: "üö´ CRITICAL: Trading disabled - system in emergency stop"
  channels: ["log", "telegram", "webhook"]
  priority: "critical"

# Performance Alerts - PnL Monitoring
- topic: metrics.update
  condition: "data.get('pnl_unrealized', 0) < -100"
  message: "üìâ HIGH LOSS: Unrealized PnL ${:.2f} - risk threshold breached"
  channels: ["log", "telegram"]
  priority: "high"

- topic: metrics.update
  condition: "abs(data.get('pnl_unrealized', 0)) > 1000"
  message: "üí∞ LARGE POSITION: PnL ${:.2f} - significant exposure"
  channels: ["log"]
  priority: "medium"

# System Health Alerts - Infrastructure Monitoring
- topic: reconnect.completed
  condition: "True"
  message: "üîÑ RECONNECT: Venue connection restored - {venue}"
  channels: ["log", "telegram"]
  priority: "medium"

- topic: reconcile.completed
  condition: "data.get('imported', 0) > 0"
  message: "üîç SYNC: Imported {imported} missed orders, closed {closed}"
  channels: ["log", "telegram"]
  priority: "medium"

# Order Book & Strategy Alerts - Market Intelligence
- topic: orderbook.update
  condition: "data.get('spread_pct', 0) > 0.01"
  message: "üìä HIGH SPREAD: {symbol} spread > 1% - potential slippage risk"
  channels: ["log"]
  priority: "low"

# Governance Alerts - Strategy & Model Changes
- topic: strategy.promoted
  condition: "True"
  message: "üöÄ MODEL PROMOTION: {model_tag} activated - performance threshold met"
  channels: ["log", "telegram"]
  priority: "medium"

# Debug & Development Alerts
- topic: error.occurred
  condition: "data.get('severity') in ['ERROR', 'CRITICAL']"
  message: "üí• ERROR: {component} - {message}"
  channels: ["log"]
  priority: "critical"

# Throttling Configuration
throttling:
  enabled: true
  window_seconds: 300  # 5 minutes
  max_alerts_per_window: 10  # Prevent spam during extreme events

# Channel Configuration
channels:
  log:
    enabled: true
    level: "WARNING"  # py logging levels

  telegram:
    enabled: true
    token_env: "TELEGRAM_ALERT_TOKEN"
    chat_id_env: "TELEGRAM_ALERT_CHAT_ID"

  webhook:
    enabled: false
    urls:
      - "https://webhook.site/your-webhook-url"  # Replace with real monitoring service

  email:
    enabled: false
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    sender_env: "ALERT_SENDER_EMAIL"
    recipients: ["alerts@yourfund.com"]
