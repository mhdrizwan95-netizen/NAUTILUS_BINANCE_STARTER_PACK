{
  "slices": [
    {
      "name": "T-00 Recon & Inventory",
      "paths": [
        "."
      ]
    },
    {
      "name": "T-ARCH Architecture Alignment",
      "paths": [
        "docs/SYSTEM_DESIGN.md",
        "engine",
        "services"
      ]
    },
    {
      "name": "T-CFG Config & Settings",
      "paths": [
        "config",
        "config.schema.json",
        "env.example",
        "ops/observability"
      ]
    },
    {
      "name": "T-CTRL-API Control Plane",
      "paths": [
        "ops/ui_api.py",
        "ops/strategy_router.py",
        "tests/ui"
      ]
    },
    {
      "name": "T-CTRL-UI Ops Dashboard",
      "paths": [
        "frontend/src/components",
        "frontend/src/lib",
        "frontend/src/App.tsx"
      ]
    },
    {
      "name": "T-FUNDS Dynamic Funds",
      "paths": [
        "ops/capital_allocator.py",
        "ops/policies.yaml",
        "ops/capital_policy.json"
      ]
    },
    {
      "name": "T-SELECT Strategy Selection",
      "paths": [
        "ops/strategy_registry.json",
        "ops/m25_governor.py",
        "engine"
      ]
    },
    {
      "name": "T-CFG-DYN Remote Config",
      "paths": [
        "ops/policies.backup.yaml",
        "ops/observability/grafana",
        "config"
      ]
    },
    {
      "name": "T-SYMBOLS Universe",
      "paths": [
        "universe",
        "ops/universe_state.json",
        "ops/policies.yaml"
      ]
    },
    {
      "name": "T-LOOP-LEARN ML Loop",
      "paths": [
        "ml_service",
        "ops/train_backfill_one.py",
        "backtests"
      ]
    },
    {
      "name": "T-HITL Human Safeguards",
      "paths": [
        "ops/governance_daemon.py",
        "docs/OPS_RUNBOOK.md",
        "ops/runbook.md"
      ]
    },
    {
      "name": "Observability, Resilience & Deployment",
      "paths": [
        "ops/observability",
        "docker-compose.yml",
        "compose.autotrain.yml",
        "compose.backfill.yml",
        "compose.ml.yml",
        "ops/quickcheck.sh"
      ]
    }
  ],
  "arch_components": [
    {
      "component": "Strategy & ML Layer",
      "docs": [
        "docs/SYSTEM_DESIGN.md#2-strategy-ml-layer"
      ],
      "code": [
        "engine/strategy.py",
        "engine/strategies/",
        "ml_service/app.py",
        "ops/strategy_router.py"
      ],
      "notes": "Strategy loop, ensemble policies, and optional external ML service align with documented flow."
    },
    {
      "component": "Execution Engine & Risk",
      "docs": [
        "docs/SYSTEM_DESIGN.md#1-execution-plane-engine"
      ],
      "code": [
        "engine/app.py",
        "engine/core/",
        "engine/risk.py",
        "engine/state/",
        "engine/storage/sqlite.py"
      ],
      "notes": "FastAPI engine, order router, risk rails, and persistence layers present as described."
    },
    {
      "component": "Ops Control Plane",
      "docs": [
        "docs/SYSTEM_DESIGN.md#3-ops-governance-layer-ops"
      ],
      "code": [
        "ops/ops_api.py",
        "ops/ui_api.py",
        "ops/ui_state.py",
        "ops/prometheus.py"
      ],
      "notes": "Control endpoints and UI router live under ops, matching documentation."
    },
    {
      "component": "Governance & Capital Allocation",
      "docs": [
        "docs/SYSTEM_DESIGN.md#3-ops-governance-layer-ops"
      ],
      "code": [
        "ops/capital_allocator.py",
        "ops/m25_governor.py",
        "ops/governance_daemon.py",
        "ops/strategy_weights.json",
        "ops/capital_policy.json"
      ],
      "notes": "Capital allocator and governor daemons exist; configs mostly present."
    },
    {
      "component": "Universe/Screener/Situations Services",
      "docs": [
        "docs/SYSTEM_DESIGN.md#3-ops-governance-layer-ops",
        "docs/SYSTEM_DESIGN.md#5-data-event-flow"
      ],
      "code": [
        "universe/service.py",
        "screener/service.py",
        "situations/service.py"
      ],
      "notes": "Ancillary services align with data flow narrative."
    },
    {
      "component": "Observability Stack",
      "docs": [
        "docs/SYSTEM_DESIGN.md#4-observability-persistence",
        "docs/SYSTEM_DESIGN.md#observability-bundle"
      ],
      "code": [
        "ops/observability/",
        "docs/observability/"
      ],
      "notes": "Prometheus/Grafana/Loki configs exactly under documented directories."
    },
    {
      "component": "Frontend Command Center",
      "docs": [
        "docs/SYSTEM_DESIGN.md"
      ],
      "code": [
        "frontend/src/App.tsx",
        "frontend/src/components/",
        "frontend/src/lib/"
      ]
    },
    {
      "component": "Data Persistence",
      "docs": [
        "docs/SYSTEM_DESIGN.md#4-observability-persistence"
      ],
      "code": [
        "engine/logs/",
        "engine/state/",
        "data/runtime/"
      ],
      "notes": "JSONL logs, snapshots, and SQLite queues match storage description."
    }
  ],
  "broken_links": [
    {
      "doc": "docs/SYSTEM_DESIGN.md#governance-automation",
      "reference": "ops/m20_playbook.py",
      "issue": "File not present in repo; governance playbook path likely renamed or removed."
    },
    {
      "doc": "docs/SYSTEM_DESIGN.md#configuration-surfaces",
      "reference": "ops/capital_allocations.json",
      "issue": "Config file absent; allocator now uses strategy_weights.json/capital_policy.json."
    },
    {
      "doc": "docs/SYSTEM_DESIGN.md#built-in-strategy-loop",
      "reference": "engine/models/active_hmm_policy.pkl",
      "issue": "Runtime artifact not versioned; consider documenting storage location or publishing sample."
    }
  ],
  "env_map": {
    "engine_core": {
      "defaults": [
        "config.example.env:3",
        "engine/config/defaults.py:22"
      ],
      "overrides": [
        ".env:1"
      ],
      "notes": "Risk rails & trading toggles derive from defaults.py and are lifted by env/config loaders."
    },
    "binance": {
      "required": [
        "BINANCE_API_KEY",
        "BINANCE_API_SECRET"
      ],
      "defaults": [
        "config.example.env:11"
      ],
      "overrides": [
        ".env:81"
      ],
      "secrets_path": "compose.hardening.override.yaml mounts /run/secrets"
    },
    "ops_api": {
      "defaults": [
        "config.example.env:21"
      ],
      "overrides": [
        ".env:94"
      ],
      "required": [
        "OPS_API_TOKEN"
      ],
      "secret_file": "config.example.env:24"
    },
    "observability": {
      "defaults": [
        "config.example.env:31"
      ],
      "notes": "Grafana admin password provided via secret file per config.example.env:33"
    },
    "ml_service": {
      "defaults": [
        "config.example.env:35",
        "engine/config/defaults.py:205"
      ],
      "compose_env": "compose.ml.yml"
    },
    "data_ingester": {
      "defaults": [
        "config.example.env:44",
        "engine/config/defaults.py:189"
      ],
      "notes": "Shared ledger path reused by ML + ingester"
    },
    "strategies": {
      "defaults": [
        "engine/config/defaults.py:48",
        "engine/config/defaults.py:145"
      ],
      "overrides": [
        ".env:22"
      ],
      "notes": "Feature switches for trend/momentum/meme/listing strategies centralised in defaults"
    }
  },
  "config_files": [
    {
      "path": "config/runtime.yaml",
      "purpose": "Risk budgets, symbol buckets, futures leverage",
      "notes": "Overrides runtime.example.yaml and is consumed by ops/state loaders"
    },
    {
      "path": "config/universe.yaml",
      "purpose": "Universe service filters & tiers",
      "notes": "Sits alongside runtime for symbol governance"
    },
    {
      "path": "config/screener.yaml",
      "purpose": "Screener thresholds and data sources",
      "notes": "Piped into screener/service.py"
    },
    {
      "path": "config/situations.json",
      "purpose": "Situational alerts definitions",
      "notes": "Used by situations/service.py"
    },
    {
      "path": "config/external_feeds.yaml",
      "purpose": "Webhook/feed credentials",
      "notes": "Ops notify + external integrations"
    },
    {
      "path": "ops/policies.yaml",
      "purpose": "Governance rules & kill-switches",
      "notes": "Read by ops/governance_daemon.py"
    },
    {
      "path": "ops/policies.backup.yaml",
      "purpose": "Fallback copy for remote config",
      "notes": "Maintained by ops/policies tooling"
    },
    {
      "path": "ops/observability/prometheus/prometheus.yml",
      "purpose": "Prometheus scrape config",
      "notes": "Augmented by docker-compose.observability.yml"
    },
    {
      "path": "docker-compose.yml",
      "purpose": "Service env injection order",
      "notes": "Compose env & .env precedence"
    }
  ],
  "control_api": [
    {
      "method": "POST",
      "path": "/api/ops/ws-session",
      "auth": "OpsToken",
      "idempotent": false,
      "notes": "Issues temporary token gating WebSocket subscriptions; requires X-Ops-Actor and logs to control_actions.jsonl."
    },
    {
      "method": "PUT",
      "path": "/api/config",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Patches runtime config via state['config'].patch with audit trail; enforced by IdempotentGuard (ops/ui_api.py:339-356)."
    },
    {
      "method": "POST",
      "path": "/api/ops/kill-switch",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Toggles trading enablement; requires Idempotency-Key via IdempotentGuard (ops/ui_api.py:444-466)."
    },
    {
      "method": "POST",
      "path": "/api/ops/flatten",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Flattens positions with audit logging; guarded by IdempotentGuard (ops/ui_api.py:470-495)."
    },
    {
      "method": "PATCH",
      "path": "/api/strategies/{strategy_id}",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Updates strategy weights/enabled flag with audit trail; requires Idempotency-Key (ops/ui_api.py:537-562)."
    },
    {
      "method": "POST",
      "path": "/api/strategies/{strategy_id}/start",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Enables strategy and stores params overrides with single-operator IdempotentGuard (ops/ui_api.py:673-704)."
    },
    {
      "method": "POST",
      "path": "/api/strategies/{strategy_id}/stop",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Disables strategy safely with audit log; single-operator IdempotentGuard (ops/ui_api.py:707-724)."
    },
    {
      "method": "POST",
      "path": "/api/strategies/{strategy_id}/update",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Persists strategy params to disk with control log under IdempotentGuard (ops/ui_api.py:728-760)."
    },
    {
      "method": "POST",
      "path": "/api/backtests",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Queues governance backtest jobs; IdempotentGuard enforces replay safety (ops/ui_api.py:832-908)."
    },
    {
      "method": "POST",
      "path": "/api/orders/cancel",
      "auth": "OpsToken",
      "idempotent": false,
      "notes": "Batch cancels orders via state['orders'].cancel_many (ops/ui_api.py:406-415)"
    },
    {
      "method": "POST",
      "path": "/api/account/transfer",
      "auth": "OpsToken",
      "idempotent": true,
      "notes": "Internal transfer across wallets/exchanges; guarded by IdempotentGuard and audited (ops/ui_api.py:774-804)."
    },
    {
      "method": "POST",
      "path": "/api/governance/reload",
      "auth": "OpsToken",
      "idempotent": false,
      "notes": "Triggers in-process policy reload via governance daemon (ops/ui_api.py:508-533)."
    }
  ],
  "policy_guards": [
    "idempotency_enforced",
    "ops_token_required",
    "single_operator_guardrails",
    "ws_actor_required"
  ],
  "ops_actions": [
    "config_patch",
    "kill_switch",
    "flatten_positions",
    "strategy_start",
    "strategy_stop",
    "strategy_update",
    "backtest_queue",
    "order_cancel",
    "account_transfer",
    "governance_reload"
  ]
}
