{
  "findings": [
    {
      "id": "config-ops-token",
      "severity": "S1",
      "area": "config",
      "file": "config.example.env",
      "lines": "21-24",
      "evidence": "config.example.env leaves OPS_API_TOKEN commented while docker-compose.yml:188 requires OPS_API_TOKEN=?; running compose fails with \"OPS_API_TOKEN must be provided via secrets manager\".",
      "impact": "Engine ops stack cannot start from documented defaults; developers following the example env hit compose interpolation failure, blocking local smoke tests and automation.",
      "fix": "Ship config.example.env with an explicit placeholder or secret-file guidance and mirror it in docs/config.schema so users set OPS_API_TOKEN before compose up.",
      "diff": "--- a/config.example.env\n+++ b/config.example.env\n@@\n-#OPS_API_TOKEN=\n-OPS_API_TOKEN_FILE=/run/secrets/ops_api_token\n+#OPS_API_TOKEN=changeme # required unless OPS_API_TOKEN_FILE points at a secret\n+OPS_API_TOKEN_FILE=/run/secrets/ops_api_token\n"
    },
    {
      "id": "config-grafana-secret-var",
      "severity": "S1",
      "area": "config",
      "file": "config.example.env",
      "lines": "28-29",
      "evidence": "config.example.env and config.schema.json document GF_SECURITY_ADMIN_PASSWORD_FILE (single underscore) but docker-compose.observability.yml:32 expects GF_SECURITY_ADMIN_PASSWORD__FILE; following the example leaves Grafana without credentials and compose aborts.",
      "impact": "Grafana container refuses to launch with \"mount Grafana admin password secret\" error, breaking the observability slice and CI smoke runs when envs are populated from the example.",
      "fix": "Rename the example + schema variable to GF_SECURITY_ADMIN_PASSWORD__FILE and keep the single-underscore variant optional only for local overrides.",
      "diff": "--- a/config.example.env\n+++ b/config.example.env\n@@\n-GF_SECURITY_ADMIN_USER=\n-GF_SECURITY_ADMIN_PASSWORD_FILE=/run/secrets/grafana_admin_password\n+GF_SECURITY_ADMIN_USER=grafana_admin\n+GF_SECURITY_ADMIN_PASSWORD__FILE=/run/secrets/grafana_admin_password\n--- a/config.schema.json\n+++ b/config.schema.json\n@@\n-                \"GF_SECURITY_ADMIN_PASSWORD_FILE\": {\n-                    \"type\": \"string\"\n-                }\n+                \"GF_SECURITY_ADMIN_PASSWORD__FILE\": {\n+                    \"type\": \"string\"\n+                }\n@@\n-                                \"GF_SECURITY_ADMIN_PASSWORD_FILE\"\n+                                \"GF_SECURITY_ADMIN_PASSWORD__FILE\"\n"
    }
  ],
  "risk_rollup": {"S0": 0, "S1": 2, "S2": 0, "S3": 0},
  "tickets": [],
  "state": {
    "env_map": {
      "OPS_API_TOKEN": {
        "defined_in": ["docker-compose.yml:188"],
        "documented_in": ["config.example.env:21-24"],
        "used_in": ["ops/ops_api.py:90", "ops/ui_api.py:36"]
      },
      "OPS_API_TOKEN_FILE": {
        "defined_in": ["docker-compose.yml:189"],
        "documented_in": ["config.example.env:23"],
        "used_in": ["ops/ops_api.py:90", "ops/ui_api.py:36"]
      },
      "GF_SECURITY_ADMIN_PASSWORD__FILE": {
        "defined_in": ["ops/observability/docker-compose.observability.yml:32"],
        "documented_in": [],
        "used_in": ["grafana container"]
      },
      "GF_SECURITY_ADMIN_PASSWORD_FILE": {
        "defined_in": ["config.example.env:28-29", "config.schema.json:100-118"],
        "documented_in": ["config.schema.json:100-118"],
        "used_in": []
      }
    },
    "config_files": [
      "config.example.env",
      "config/runtime.yaml",
      "config/schema.json",
      "docker-compose.yml",
      "ops/observability/docker-compose.observability.yml"
    ]
  }
}
