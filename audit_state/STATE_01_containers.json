{"findings":[{"id":"container-grafana-default-admin","severity":"S1","area":"security","file":"ops/observability/docker-compose.observability.yml","lines":"31-35","evidence":"GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER:-admin}\nGF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD:-admin}","impact":"Grafana boots with a public default admin/admin credential, so anyone on the network—or with a forwarded port—can take over dashboards, Alertmanager hooks, and stored datasource secrets.","fix":"Make the admin user/password required secrets (or provide *_FILE variants) so production deploys fail fast unless credentials come from the secrets manager.","diff":"--- a/ops/observability/docker-compose.observability.yml\n+++ b/ops/observability/docker-compose.observability.yml\n@@\n-      - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER:-admin}\n-      - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD:-admin}\n-      - GF_AUTH_ANONYMOUS_ENABLED=${GF_AUTH_ANONYMOUS_ENABLED:-false}\n+      - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER:?set via secrets manager}\n+      - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD:?set via secrets manager}\n+      - GF_SECURITY_ADMIN_PASSWORD__FILE=${GF_SECURITY_ADMIN_PASSWORD__FILE:-}\n+      - GF_AUTH_ANONYMOUS_ENABLED=${GF_AUTH_ANONYMOUS_ENABLED:-false}"},{"id":"compose-ops-dev-token","severity":"S1","area":"security","file":"docker-compose.yml","lines":"188-209","evidence":"OPS_API_TOKEN: \"dev-token\"  # Set to actual token for production","impact":"The ops API ships with a hard-coded bearer token, so any leaked compose bundle or shared cluster instantly exposes privileged admin endpoints until the operator remembers to override it.","fix":"Require OPS_API_TOKEN (or an *_FILE indirection) to be provided and fail fast otherwise; document sourcing it from Docker/Swarm secrets or env files.","diff":"--- a/docker-compose.yml\n+++ b/docker-compose.yml\n@@\n-      OPS_API_TOKEN: \"dev-token\"  # Set to actual token for production\n+      OPS_API_TOKEN: ${OPS_API_TOKEN:?OPS_API_TOKEN must be provided via secrets manager}\n+      OPS_API_TOKEN_FILE: ${OPS_API_TOKEN_FILE:-}\n@@\n       ENGINE_ENDPOINTS: \"${ENGINE_ENDPOINTS:-http://engine_binance:8003}\""},{"id":"ops-dockerfile-root-user","severity":"S2","area":"containers","file":"ops/Dockerfile","lines":"1-48","evidence":"FROM python:3.11-slim\n...\nCMD [\"python\",\"-u\",\"ops/main.py\"]","impact":"The ops image runs as root from a floating base tag, so any RCE in uvicorn or third-party libs leads to full container escape paths (host mounts) and unpredictable upgrades when python:3.11-slim advances.","fix":"Pin the base image to python:3.11.9-slim, create an unprivileged user, chown the workspace, and drop to USER appuser before runtime.","diff":"--- a/ops/Dockerfile\n+++ b/ops/Dockerfile\n@@\n-FROM python:3.11-slim AS builder\n+FROM python:3.11.9-slim AS builder\n@@\n-FROM python:3.11-slim\n+FROM python:3.11.9-slim\n@@\n COPY --from=builder /install /usr/local\n COPY ops/ ./ops/\n+\n+RUN useradd -r -u 1000 appuser \\\n+ && chown -R appuser:appuser /app\n+\n+USER appuser\n \n ENV ENGINE_URL=http://engine_binance:8003 \\\n     ENABLE_EXECUTION=true"},{"id":"backtester-dockerfile-root","severity":"S2","area":"containers","file":"services/backtester/Dockerfile","lines":"1-9","evidence":"FROM python:3.11-slim\n...\nCMD [\"python\",\"-m\",\"app.main\"]","impact":"The backtester image builds from a floating python tag, installs requirements without constraints, and runs as root; a compromised dependency can mutate the image or the host-mounted research data.","fix":"Pin to python:3.11.9-slim, reuse the repo constraints file, and drop to a dedicated non-root user before launching the module.","diff":"--- a/services/backtester/Dockerfile\n+++ b/services/backtester/Dockerfile\n@@\n-FROM python:3.11-slim\n+FROM python:3.11.9-slim\n@@\n-COPY services/backtester/requirements.txt ./requirements.txt\n-# hadolint ignore=DL3013\n-RUN pip install --upgrade pip && pip install -r requirements.txt\n+COPY services/backtester/requirements.txt ./requirements.txt\n+COPY constraints.txt /constraints.txt\n+# hadolint ignore=DL3013\n+RUN pip install --upgrade pip && pip install -c /constraints.txt -r requirements.txt\n \n COPY services/backtester/app ./app\n+\n+RUN useradd -r -u 1000 appuser \\\n+ && chown -R appuser:appuser /app\n+\n+USER appuser\n \n ENV DATASET=/historical/sample.csv     START=0     END=0     STEP_MINUTES=5     RETRAIN_EVERY_MIN=360     EXACTLY_ONCE=true     COST_BPS=1.0     SLIPPAGE_BPS_PER_VOL=2.0"}],"risk_rollup":{"S0":0,"S1":2,"S2":2,"S3":0},"tickets":[{"title":"Harden container secrets and credentials before shipping observability stack","owner":"platform","eta":"3d","blocks":[],"acceptance":["OPS_API_TOKEN enforced via env or *_FILE","Grafana admin creds sourced from secret store","smoke.sh passes with overrides applied"]},{"title":"Drop root from ops/backtester images and pin python tag","owner":"infra","eta":"4d","blocks":[],"acceptance":["ops and backtester Dockerfiles use python:3.11.9-slim","Both images run as non-root user","Image rebuild shows identical functionality via smoke.sh"]}],"state":{"ports":{"engine_binance":8003,"engine_binance_exporter":9103,"ops":8002,"executor_metrics":9102,"universe":8009,"screener":8010,"situations":8011,"deck":8012,"data_ingester":8001,"ml_service":8000,"param_controller":8002,"grafana":3000,"prometheus":9090,"alertmanager":9093,"loki":3100},"env_map_refs":["OPS_API_TOKEN","OPS_API_TOKEN_FILE","GF_SECURITY_ADMIN_USER","GF_SECURITY_ADMIN_PASSWORD","GF_SECURITY_ADMIN_PASSWORD__FILE"]}}
