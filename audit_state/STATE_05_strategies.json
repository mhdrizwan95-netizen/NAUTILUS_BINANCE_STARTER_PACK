{
  "findings": [
    {
      "id": "risk-trading-enabled-default",
      "severity": "S1",
      "area": "risk",
      "file": "engine/config/__init__.py",
      "lines": "214-236",
      "evidence": "When TRADING_ENABLED is unset, load_risk_config falls back to env_bool('DRY_RUN', True), so the default result is trading_enabled=True even in the dry-run profile.",
      "impact": "Operators copying the repo and leaving TRADING_ENABLED undefined expect dry-run safety, but RiskRails reports trading_enabled=True and /orders/market calls from ops/routes/orders.py go live if API keys exist.",
      "fix": "Derive trading_enabled from the inverse of DRY_RUN whenever TRADING_ENABLED is absent so the default posture remains disabled, while still honoring explicit TRADING_ENABLED overrides.",
      "diff": "diff --git a/engine/config/__init__.py b/engine/config/__init__.py\n@@\n-    if trading_enabled_env is None:\n-        trading_enabled = env_bool(\"DRY_RUN\", GLOBAL_DEFAULTS[\"DRY_RUN\"])\n-    else:\n-        trading_enabled = env_bool(\"TRADING_ENABLED\", RISK_DEFAULTS[\"TRADING_ENABLED\"])\n+    if trading_enabled_env is None:\n+        trading_enabled = not env_bool(\"DRY_RUN\", GLOBAL_DEFAULTS[\"DRY_RUN\"])\n+    else:\n+        trading_enabled = env_bool(\"TRADING_ENABLED\", RISK_DEFAULTS[\"TRADING_ENABLED\"])"
    },
    {
      "id": "risk-quantity-price-miss",
      "severity": "S1",
      "area": "risk",
      "file": "engine/risk.py",
      "lines": "217-244",
      "evidence": "RiskRails.check_order converts quantity to notional using last_price; if pricing fails (last_price stays 0) and the order only supplies quantity, delta_signed remains 0 so exposure and min/max checks never fire.",
      "impact": "Quantity-based strategies (e.g. momentum_15m signals with quote=None at engine/strategies/momentum_15m.py:118-141) can slip through when price lookups lag or on newly-listed symbols, resulting in unbounded position sizes because breakers see zero delta.",
      "fix": "Abort quantity-only orders when no price is available and surface a PRICE_UNAVAILABLE error so the caller can retry once market data is live.",
      "diff": "diff --git a/engine/risk.py b/engine/risk.py\n@@\n-        qty = float(quantity) if quantity else 0.0\n-        quote_amt = float(quote) if quote else 0.0\n-        side_mult = 1.0 if side.upper() == \"BUY\" else -1.0\n-        delta_signed = side_mult * (\n-            quote_amt if quote_amt else qty * float(last_price or 0.0)\n-        )\n+        qty = float(quantity) if quantity else 0.0\n+        quote_amt = float(quote) if quote else 0.0\n+        if quote_amt <= 0 and qty > 0 and last_price <= 0:\n+            return False, {\n+                \"error\": \"PRICE_UNAVAILABLE\",\n+                \"message\": f\"Unable to price {symbol} for risk checks; retry when market data is available.\",\n+            }\n+        side_mult = 1.0 if side.upper() == \"BUY\" else -1.0\n+        delta_signed = side_mult * (\n+            quote_amt if quote_amt else qty * float(last_price or 0.0)\n+        )"
    }
  ],
  "risk_rollup": {
    "S0": 0,
    "S1": 2,
    "S2": 0,
    "S3": 0
  },
  "tickets": [
    {
      "title": "Align risk defaults with dry-run mode and guard quantity-only orders",
      "owner": "platform",
      "eta": "3d",
      "blocks": [],
      "acceptance": [
        "Risk config defaults to trading_enabled=False unless explicitly enabled",
        "Quantity-only orders without a price return PRICE_UNAVAILABLE",
        "Regression test covers both behaviours"
      ]
    }
  ],
  "state": {
    "strategy_files": [
      "engine/strategies/momentum_15m.py",
      "engine/strategies/meme_coin_sentiment.py",
      "engine/strategies/listing_sniper.py"
    ],
    "risk_defaults": {
      "MIN_NOTIONAL_USDT": 10.0,
      "MAX_NOTIONAL_USDT": 1000.0,
      "EXPOSURE_CAP_SYMBOL_USD": 2000.0,
      "EXPOSURE_CAP_TOTAL_USD": 10000.0
    },
    "risk_notes": [
      "StrategyExecutor gates every signal through RiskRails",
      "Momentum_15m issues quantity-only signals by default"
    ]
  }
}
