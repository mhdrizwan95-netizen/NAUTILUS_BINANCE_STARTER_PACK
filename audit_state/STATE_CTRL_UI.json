{
  "control_api": [
    {
      "component": "App.tsx handleModeChange",
      "ui_ref": "frontend/src/App.tsx:231",
      "endpoint": "PUT /api/config",
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": "generateIdempotencyKey('mode-${newMode}')"
    },
    {
      "component": "App.tsx handlePause",
      "ui_ref": "frontend/src/App.tsx:261",
      "endpoint": "POST /api/ops/kill-switch",
      "payload": {
        "enabled": false
      },
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": "generateIdempotencyKey('pause')"
    },
    {
      "component": "App.tsx handleResume",
      "ui_ref": "frontend/src/App.tsx:279",
      "endpoint": "POST /api/ops/kill-switch",
      "payload": {
        "enabled": true
      },
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": "generateIdempotencyKey('resume')"
    },
    {
      "component": "App.tsx handleFlatten",
      "ui_ref": "frontend/src/App.tsx:295",
      "endpoint": "POST /api/ops/flatten",
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": "generateIdempotencyKey('flatten')"
    },
    {
      "component": "App.tsx handleKillSwitch",
      "ui_ref": "frontend/src/App.tsx:315",
      "endpoint": "POST /api/ops/kill-switch + POST /api/ops/flatten",
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": [
        "generateIdempotencyKey('kill-pause')",
        "generateIdempotencyKey('kill-flatten')"
      ],
      "requires_reason": true
    },
    {
      "component": "SettingsTab handleSubmit",
      "ui_ref": "frontend/src/components/tabs/SettingsTab.tsx:140",
      "endpoint": "PUT /api/config",
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor",
        "X-Ops-Approver",
        "Idempotency-Key"
      ],
      "idempotency_source": "generateIdempotencyKey('config')"
    },
    {
      "component": "useWebSocket requestSession",
      "ui_ref": "frontend/src/lib/websocket.ts:260",
      "endpoint": "POST /api/ops/ws-session",
      "headers": [
        "X-Ops-Token",
        "X-Ops-Actor"
      ],
      "idempotency_source": "generateIdempotencyKey('ws-session')"
    }
  ],
  "ops_actions": [
    "toggle_mode",
    "pause_trading",
    "resume_trading",
    "flatten_positions",
    "kill_switch",
    "save_config_overrides",
    "issue_ws_session"
  ],
  "policy_guards": [
    "ws_message_once_guard"
  ],
  "policy_guard_details": {
    "ws_message_once_guard": "App.tsx (frontend/src/App.tsx:193-200) memoizes the last processed WebSocket payload so React Query hydration runs at most once per message, preventing nested rerender loops."
  },
  "rbac": {
    "roles": {
      "viewer": {
        "description": "Read-only access to dashboards and health widgets",
        "capabilities": [
          "read:dashboard",
          "read:metrics",
          "read:alerts"
        ]
      },
      "operator": {
        "description": "Authenticated operator with OPS token and call-sign",
        "capabilities": [
          "viewer",
          "control:pause",
          "control:resume",
          "control:flatten",
          "config:patch",
          "ws:session"
        ]
      },
      "approver": {
        "description": "Second approver token required for high-risk commands",
        "capabilities": [
          "operator",
          "approve:kill-switch",
          "approve:config",
          "approve:flatten"
        ]
      }
    },
    "ui_requirements": [
      {
        "control": "TopHUD.pause",
        "requires": "operator+approver"
      },
      {
        "control": "TopHUD.resume",
        "requires": "operator+approver"
      },
      {
        "control": "TopHUD.flatten",
        "requires": "operator+approver"
      },
      {
        "control": "TopHUD.kill",
        "requires": "operator+approver"
      },
      {
        "control": "SettingsTab.saveOverrides",
        "requires": "operator+approver"
      },
      {
        "control": "WebSocket.connect",
        "requires": "operator"
      }
    ],
    "storage": {
      "opsAuth": {
        "persisted": false,
        "source": "frontend/src/lib/store.ts:212",
        "notes": "OPS credentials remain in-memory and are never stored in localStorage"
      }
    }
  }
}
