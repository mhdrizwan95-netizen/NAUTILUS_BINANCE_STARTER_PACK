import{c as M,j as e,h as G,N as Q,F as c,r as o,m as Y,C as u,O as m,Q as h,R as x,B as f,aa as V,T as g,S as O,K as a,q as P,U as $,J as W,Y as X}from"./index-Rk7jxlAW.js";import{u as Z}from"./useMutation-BqS71wKq.js";import{B as ee}from"./badge-DbHrsCMU.js";import{I as S}from"./input-DrLZrDxf.js";import{L as E}from"./label-Duf-LRMe.js";import{v as L,f as B}from"./validation-COF01_rP.js";import{D as re}from"./download-CQ9v00CE.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],te=M("copy",se);function ne({className:v,...i}){return e.jsx("textarea",{"data-slot":"textarea",className:G("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",v),...i})}const oe=[{key:"DRY_RUN",label:"Dry Run",description:"Route execution in simulation mode without placing real orders."},{key:"SYMBOL_SCANNER_ENABLED",label:"Symbol Scanner",description:"Continuously refresh the universe scanner feed."},{key:"SOFT_BREACH_ENABLED",label:"Soft Breach Guard",description:"Alerts and guard-rail for risk rails before hard stops trigger."},{key:"SOFT_BREACH_BREAKEVEN_OK",label:"Breakeven Allowed",description:"Permit breakeven exits when a soft breach fires."},{key:"SOFT_BREACH_CANCEL_ENTRIES",label:"Cancel Entries",description:"Cancel outstanding entry orders when a soft breach triggers."}];function me(){const v=Q(),i=c(r=>r.opsAuth.token),y=c(r=>r.opsAuth.actor),D=c(r=>r.setOpsToken),F=c(r=>r.setOpsActor),J=c(r=>r.setOpsApprover),l=c(r=>r.opsAuth.approver),[U,C]=o.useState(i),[A,k]=o.useState(y),[w,T]=o.useState(l),[p,j]=o.useState("{}"),[b,_]=o.useState(!1),s=Y({queryKey:P.settings.config(),queryFn:()=>X().then(r=>L(B,r,"Runtime config")),refetchInterval:6e4});o.useEffect(()=>{!s.data||b||j(JSON.stringify(s.data.overrides??{},null,2))},[s.data,b]),o.useEffect(()=>{C(i)},[i]),o.useEffect(()=>{k(y)},[y]),o.useEffect(()=>{T(l)},[l]);const R=o.useMemo(()=>{const r=s.data?.effective?.SOFT_BREACH_TIGHTEN_SL_PCT??s.data?.overrides?.SOFT_BREACH_TIGHTEN_SL_PCT;return typeof r=="number"?r:null},[s.data]),N=Z({mutationFn:async({patch:r,options:n})=>{const t=await $(r,n);return L(B,t,"Updated runtime config")},onSuccess:r=>{a.success("Runtime configuration updated"),_(!1),j(JSON.stringify(r.overrides??{},null,2)),v.setQueryData(P.settings.config(),r)},onError:r=>{a.error("Failed to update configuration",{description:r instanceof Error?r.message:"Unknown error occurred"})}}),z=o.useMemo(()=>{try{const r=JSON.parse(p||"{}");return!(r&&typeof r=="object"&&!Array.isArray(r))}catch{return!0}},[p]),K=()=>{if(!i.trim()){a.error("Provide an OPS API token to update configuration");return}if(!l.trim()){a.error("Provide an approver token (two-man rule) to update configuration");return}let r;try{r=JSON.parse(p||"{}")}catch(n){a.error("Overrides JSON is invalid",{description:n instanceof Error?n.message:void 0});return}if(!r||typeof r!="object"||Array.isArray(r)){a.error("Overrides must be a JSON object");return}N.mutate({patch:r,options:{token:i.trim(),actor:A.trim()||void 0,approverToken:w.trim()||void 0,idempotencyKey:W("config")}})},H=async(r,n)=>{try{await navigator.clipboard.writeText(JSON.stringify(r,null,2)),a.success(`${n} copied to clipboard`)}catch(t){a.error(`Unable to copy ${n}`,{description:t instanceof Error?t.message:void 0})}},q=(r,n)=>{try{const t=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),I=URL.createObjectURL(t),d=document.createElement("a");d.href=I,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(I)}catch(t){a.error("Download failed",{description:t instanceof Error?t.message:void 0})}};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs(u,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"OPS API Token"}),e.jsx(x,{children:"Provide the bearer token required by the Ops API. The value stays in memory only."})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s.refetch(),disabled:s.isRefetching,children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Refresh config"]})]}),e.jsxs(g,{className:"space-y-3",children:[e.jsx(E,{htmlFor:"ops-token",children:"X-Ops-Token header"}),e.jsx(S,{id:"ops-token",type:"password",value:U,onChange:r=>{C(r.target.value),D(r.target.value)},placeholder:"Paste OPS_API_TOKEN value",autoComplete:"off"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["When running locally, export ",e.jsx("code",{children:"OPS_API_TOKEN"})," or ",e.jsx("code",{children:"OPS_API_TOKEN_FILE"})," and reuse that value here for authenticated updates."]}),e.jsx(E,{htmlFor:"ops-actor",className:"pt-2",children:"Operator (audit log)"}),e.jsx(S,{id:"ops-actor",type:"text",value:A,onChange:r=>{k(r.target.value),F(r.target.value)},placeholder:"Enter your call-sign or initials",autoComplete:"off"}),e.jsx(E,{htmlFor:"ops-approver",className:"pt-2",children:"Approver token"}),e.jsx(S,{id:"ops-approver",type:"password",value:w,onChange:r=>{T(r.target.value),J(r.target.value)},placeholder:"Second approver token (two-man rule)",autoComplete:"off"})]})]}),e.jsxs(u,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Protection & Automation Flags"}),e.jsxs(x,{children:["Values reflect ",e.jsx("code",{children:"config/runtime.yaml"})," merged with overrides."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>H(s.data?.overrides??{},"Overrides JSON"),disabled:s.isLoading,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Copy overrides"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>q(s.data?.effective??{},"runtime-config.json"),disabled:s.isLoading,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Download config"]})]})]}),e.jsxs(g,{children:[s.isLoading?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:5}).map((r,n)=>e.jsx(O,{className:"h-24 rounded-xl"},n))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:oe.map(r=>{const t=(s.data?.effective?.[r.key]??s.data?.overrides?.[r.key])===!0;return e.jsxs("div",{className:"rounded-xl border border-zinc-800/60 bg-zinc-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-200",children:r.label}),e.jsx(ee,{variant:t?"secondary":"outline",className:t?"bg-emerald-500/10 text-emerald-300":"",children:t?"ENABLED":"DISABLED"})]}),e.jsx("p",{className:"text-xs text-zinc-500",children:r.description})]},r.key)})}),e.jsxs("div",{className:"mt-6 rounded-xl border border-zinc-800/60 bg-zinc-900/40 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-200",children:"Soft Breach tighten stop-loss"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Percentage applied to tighten the stop-loss when a soft breach occurs."}),e.jsx("div",{className:"mt-3 text-lg font-semibold text-zinc-100",children:R!==null?`${(R*100).toFixed(1)}%`:"—"})]})]})]}),e.jsxs(u,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Runtime Overrides"}),e.jsxs(x,{children:["Edit the JSON payload sent to ",e.jsx("code",{children:"PUT /api/config"}),"."]})]}),e.jsx(f,{variant:"secondary",size:"sm",onClick:K,disabled:N.isPending||z||!b,children:N.isPending?"Saving…":"Save overrides"})]}),e.jsx(g,{children:s.isLoading?e.jsx(O,{className:"h-48 w-full"}):e.jsxs("div",{className:"rounded-lg border border-zinc-800/60 bg-zinc-950/40 p-4 space-y-3",children:[e.jsx(ne,{value:p,onChange:r=>{j(r.target.value),_(!0)},className:"h-64 font-mono text-xs"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Example: ",e.jsx("code",{children:'{"DRY_RUN": false, "SOFT_BREACH_ENABLED": true}'})]}),z&&e.jsx("p",{className:"text-xs text-amber-400",children:"Overrides must be valid JSON representing an object."})]})})]}),e.jsxs(u,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Effective Configuration"}),e.jsxs(x,{children:["Resulting payload served to clients (",e.jsx("code",{children:"config/runtime.yaml"})," merged with overrides)."]})]}),e.jsx(g,{children:s.isLoading?e.jsx(O,{className:"h-64 w-full"}):e.jsx("div",{className:"rounded-lg border border-zinc-800/60 bg-zinc-950/40 p-4",children:e.jsx("pre",{className:"max-h-80 overflow-auto text-xs leading-6 text-zinc-300",children:JSON.stringify(s.data?.effective??{},null,2)})})})]}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Updates apply immediately and are persisted by the Ops service. Keep your token secure; the Command Center never stores it beyond this session."})]})}export{me as SettingsTab};
//# sourceMappingURL=SettingsTab-BWZivFFI.js.map
