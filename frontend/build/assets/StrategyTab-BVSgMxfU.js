import{c as I,r as l,z as ie,j as e,b as le,A as _,d as O,P as D,e as y,u as k,D as ce,E as de,h as N,F as E,C as ue,G as pe,B as P,H as fe,I as L,J as ge,K as p,p as me,L as xe,M as he}from"./index-Rk7jxlAW.js";import{B as ve}from"./badge-DbHrsCMU.js";import{S as je}from"./separator-Catm7xgr.js";import{P as ye,h as De,R as Ne,u as Ce,F as be,D as we,a as Se,L as Re,b as _e}from"./LineChart-CsN3wN5o.js";import{D as Ee}from"./DynamicParamForm-DUZG5EXW.js";import"./input-DrLZrDxf.js";import"./label-Duf-LRMe.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Ie=I("settings-2",Pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],ke=I("square",Oe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Te=I("x",Ae);var S="Dialog",[z]=le(S),[Fe,f]=z(S),W=t=>{const{__scopeDialog:o,children:r,open:i,defaultOpen:s,onOpenChange:n,modal:d=!0}=t,u=l.useRef(null),g=l.useRef(null),[j,v]=ie({prop:i,defaultProp:s??!1,onChange:n,caller:S});return e.jsx(Fe,{scope:o,triggerRef:u,contentRef:g,contentId:_(),titleId:_(),descriptionId:_(),open:j,onOpenChange:v,onOpenToggle:l.useCallback(()=>v(x=>!x),[v]),modal:d,children:r})};W.displayName=S;var q="DialogTrigger",Me=l.forwardRef((t,o)=>{const{__scopeDialog:r,...i}=t,s=f(q,r),n=k(o,s.triggerRef);return e.jsx(D.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":F(s.open),...i,ref:n,onClick:y(t.onClick,s.onOpenToggle)})});Me.displayName=q;var A="DialogPortal",[$e,B]=z(A,{forceMount:void 0}),G=t=>{const{__scopeDialog:o,forceMount:r,children:i,container:s}=t,n=f(A,o);return e.jsx($e,{scope:o,forceMount:r,children:l.Children.map(i,d=>e.jsx(O,{present:r||n.open,children:e.jsx(ye,{asChild:!0,container:s,children:d})}))})};G.displayName=A;var w="DialogOverlay",U=l.forwardRef((t,o)=>{const r=B(w,t.__scopeDialog),{forceMount:i=r.forceMount,...s}=t,n=f(w,t.__scopeDialog);return n.modal?e.jsx(O,{present:i||n.open,children:e.jsx(ze,{...s,ref:o})}):null});U.displayName=w;var Le=ce("DialogOverlay.RemoveScroll"),ze=l.forwardRef((t,o)=>{const{__scopeDialog:r,...i}=t,s=f(w,r);return e.jsx(Ne,{as:Le,allowPinchZoom:!0,shards:[s.contentRef],children:e.jsx(D.div,{"data-state":F(s.open),...i,ref:o,style:{pointerEvents:"auto",...i.style}})})}),h="DialogContent",H=l.forwardRef((t,o)=>{const r=B(h,t.__scopeDialog),{forceMount:i=r.forceMount,...s}=t,n=f(h,t.__scopeDialog);return e.jsx(O,{present:i||n.open,children:n.modal?e.jsx(We,{...s,ref:o}):e.jsx(qe,{...s,ref:o})})});H.displayName=h;var We=l.forwardRef((t,o)=>{const r=f(h,t.__scopeDialog),i=l.useRef(null),s=k(o,r.contentRef,i);return l.useEffect(()=>{const n=i.current;if(n)return De(n)},[]),e.jsx(K,{...t,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:y(t.onCloseAutoFocus,n=>{n.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:y(t.onPointerDownOutside,n=>{const d=n.detail.originalEvent,u=d.button===0&&d.ctrlKey===!0;(d.button===2||u)&&n.preventDefault()}),onFocusOutside:y(t.onFocusOutside,n=>n.preventDefault())})}),qe=l.forwardRef((t,o)=>{const r=f(h,t.__scopeDialog),i=l.useRef(!1),s=l.useRef(!1);return e.jsx(K,{...t,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{t.onCloseAutoFocus?.(n),n.defaultPrevented||(i.current||r.triggerRef.current?.focus(),n.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:n=>{t.onInteractOutside?.(n),n.defaultPrevented||(i.current=!0,n.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const d=n.target;r.triggerRef.current?.contains(d)&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&s.current&&n.preventDefault()}})}),K=l.forwardRef((t,o)=>{const{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:n,...d}=t,u=f(h,r),g=l.useRef(null),j=k(o,g);return Ce(),e.jsxs(e.Fragment,{children:[e.jsx(be,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:n,children:e.jsx(we,{role:"dialog",id:u.contentId,"aria-describedby":u.descriptionId,"aria-labelledby":u.titleId,"data-state":F(u.open),...d,ref:j,onDismiss:()=>u.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(Be,{titleId:u.titleId}),e.jsx(Ue,{contentRef:g,descriptionId:u.descriptionId})]})]})}),T="DialogTitle",V=l.forwardRef((t,o)=>{const{__scopeDialog:r,...i}=t,s=f(T,r);return e.jsx(D.h2,{id:s.titleId,...i,ref:o})});V.displayName=T;var J="DialogDescription",X=l.forwardRef((t,o)=>{const{__scopeDialog:r,...i}=t,s=f(J,r);return e.jsx(D.p,{id:s.descriptionId,...i,ref:o})});X.displayName=J;var Y="DialogClose",Z=l.forwardRef((t,o)=>{const{__scopeDialog:r,...i}=t,s=f(Y,r);return e.jsx(D.button,{type:"button",...i,ref:o,onClick:y(t.onClick,()=>s.onOpenChange(!1))})});Z.displayName=Y;function F(t){return t?"open":"closed"}var Q="DialogTitleWarning",[ft,ee]=de(Q,{contentName:h,titleName:T,docsSlug:"dialog"}),Be=({titleId:t})=>{const o=ee(Q),r=`\`${o.contentName}\` requires a \`${o.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${o.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${o.docsSlug}`;return l.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},Ge="DialogDescriptionWarning",Ue=({contentRef:t,descriptionId:o})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ee(Ge).contentName}}.`;return l.useEffect(()=>{const s=t.current?.getAttribute("aria-describedby");o&&s&&(document.getElementById(o)||console.warn(i))},[i,t,o]),null},He=W,Ke=G,Ve=U,Je=H,Xe=V,Ye=X,Ze=Z;function Qe({...t}){return e.jsx(He,{"data-slot":"dialog",...t})}function et({...t}){return e.jsx(Ke,{"data-slot":"dialog-portal",...t})}const te=l.forwardRef(({className:t,...o},r)=>e.jsx(Ve,{ref:r,"data-slot":"dialog-overlay",className:N("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...o}));te.displayName="DialogOverlay";function tt({className:t,children:o,...r}){return e.jsxs(et,{"data-slot":"dialog-portal",children:[e.jsx(te,{}),e.jsxs(Je,{"data-slot":"dialog-content",className:N("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[o,e.jsxs(Ze,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Te,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function at({className:t,...o}){return e.jsx("div",{"data-slot":"dialog-header",className:N("flex flex-col gap-2 text-center sm:text-left",t),...o})}function ot({className:t,...o}){return e.jsx(Xe,{"data-slot":"dialog-title",className:N("text-lg leading-none font-semibold",t),...o})}function nt({className:t,...o}){return e.jsx(Ye,{"data-slot":"dialog-description",className:N("text-muted-foreground text-sm",t),...o})}const ae=l.memo(({data:t,color:o,trend:r})=>{const i=t.map((s,n)=>({value:s,index:n}));return e.jsx(Se,{width:"100%",height:"100%",children:e.jsx(Re,{data:i,children:e.jsx(_e,{type:"monotone",dataKey:"value",stroke:o,strokeWidth:1.5,dot:!1,isAnimationActive:!1})})})});ae.displayName="MiniChart";function st(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}).format(t)}function gt(){const[t,o]=l.useState([]),[r,i]=l.useState(!1),[s,n]=l.useState(null),[d,u]=l.useState(null),g=E(a=>a.opsAuth.token),j=E(a=>a.opsAuth.actor),v=E(a=>a.opsAuth.approver),x=async()=>{i(!0);try{const a=await me();o(a)}catch(a){a instanceof Error&&p.error("Unable to load strategies",{description:a.message})}finally{i(!1)}};l.useEffect(()=>{x()},[]);const C=()=>g.trim()?v.trim()?!0:(p.error("Provide an approver token (two-man rule) before issuing control actions"),!1):(p.error("Set OPS API token in Settings before issuing control actions"),!1),b=a=>({token:g.trim(),actor:j.trim()||void 0,approverToken:v.trim()||void 0,idempotencyKey:ge(a)}),oe=async(a,c)=>{if(C()){n(a.id);try{const m={...a.params??{},dry_run:c};await L(a.id,m,b(`dryrun-${a.id}`)),p.success(`Dry run ${c?"enabled":"disabled"} for ${a.name}`),await x()}catch(m){m instanceof Error&&p.error("Failed to toggle dry run",{description:m.message})}finally{n(null)}}},ne=async a=>{if(C()){n(a.id);try{await xe(a.id,a.params,b(`start-${a.id}`)),p.success(`Started ${a.name}`),await x()}catch(c){c instanceof Error&&p.error("Failed to start strategy",{description:c.message})}finally{n(null)}}},se=async a=>{if(C()){n(a.id);try{await he(a.id,b(`stop-${a.id}`)),p("Strategy stopped",{description:a.name}),await x()}catch(c){c instanceof Error&&p.error("Failed to stop strategy",{description:c.message})}finally{n(null)}}},re=l.useMemo(()=>t,[t]);return e.jsxs("div",{className:"mx-auto max-w-6xl space-y-4 p-6",children:[r&&t.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading strategies…"}):null,e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:re.map(a=>{const c=a.performance,m=c?.equitySeries?.length?c.equitySeries.at(-1).equity>=c.equitySeries[0].equity?"up":"down":"neutral",M=c?.equitySeries?.map(R=>R.equity)??[],$=c?.pnl??0;return e.jsxs(ue,{className:"flex flex-col gap-4 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold",children:a.name}),e.jsx(ve,{variant:a.status==="running"?"secondary":a.status==="error"?"destructive":"outline",children:a.status.toUpperCase()})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.kind," • ",a.symbols.join(", ")]})]}),e.jsx("div",{className:"h-16 w-40",children:M.length>1?e.jsx(ae,{data:M,color:m==="up"?"#10b981":m==="down"?"#ef4444":"#6366f1",trend:m}):e.jsx("div",{className:"flex h-full items-center justify-center text-xs text-muted-foreground",children:"No data"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"PnL"}),e.jsx("p",{className:$>=0?"text-emerald-400":"text-red-400",children:st($)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Win Rate"}),e.jsx("p",{children:c?.winRate!==void 0?`${(c.winRate*100).toFixed(1)}%`:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Sharpe"}),e.jsx("p",{children:c?.sharpe!==void 0?c.sharpe.toFixed(2):"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Drawdown"}),e.jsx("p",{children:c?.drawdown!==void 0?`${(c.drawdown*100).toFixed(1)}%`:"—"})]})]}),e.jsx("div",{className:"rounded-lg border border-zinc-800/60 bg-zinc-950/40 p-3 text-xs",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-zinc-200",children:"Dry run mode"}),e.jsx("p",{className:"text-zinc-500",children:"Simulate orders without placing live trades."})]}),e.jsx(pe,{checked:!!a.params?.dry_run,disabled:s===a.id,onCheckedChange:R=>oe(a,R)})]})}),e.jsx(je,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.status!=="running"?e.jsxs(P,{size:"sm",onClick:()=>ne(a),disabled:s===a.id,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Start"]}):e.jsxs(P,{size:"sm",variant:"destructive",onClick:()=>se(a),disabled:s===a.id,className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Stop"]}),e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>u(a),className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Configure"]})]})]},a.id)})}),e.jsx(Qe,{open:d!==null,onOpenChange:a=>!a&&u(null),children:e.jsxs(tt,{className:"max-w-xl",children:[d&&e.jsxs(at,{children:[e.jsxs(ot,{children:["Configure ",d.name]}),e.jsx(nt,{children:"Update parameters and apply instantly. Changes propagate on the next signal tick."})]}),d&&e.jsx(Ee,{schema:d.paramsSchema,initial:d.params,submitLabel:"Save",onSubmit:async a=>{if(C()){n(d.id);try{await L(d.id,a,b(`update-${d.id}`)),p.success("Strategy updated"),u(null),await x()}catch(c){c instanceof Error&&p.error("Failed to update strategy",{description:c.message})}finally{n(null)}}}})]})})]})}export{gt as StrategyTab};
//# sourceMappingURL=StrategyTab-BVSgMxfU.js.map
