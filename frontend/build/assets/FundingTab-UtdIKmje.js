import{c as _,m as g,r as q,j as e,C as b,J as N,K as v,L as z,M as L,S,N as w,q as p,O as D,Q as E}from"./index-DWw6XOll.js";import{B as j}from"./badge-BdbezaWL.js";import{T,a as C,b as h,c as i,d as F,e as l}from"./table-C9mFoWu7.js";import{v as y,b as A,e as M,c as P}from"./validation-COF01_rP.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],$=_("chart-no-axes-column",R);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],K=_("dollar-sign",H);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],Q=_("trending-up",O);function o(t,a={}){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2,minimumFractionDigits:2,...a}).format(t)}function U(t){return`${(t*100).toFixed(2)}%`}function I(t){return t?new Date(t*1e3).toLocaleString():"—"}function W(){const t=g({queryKey:p.funding.portfolio(),queryFn:()=>w().then(s=>y(A,s,"Aggregate portfolio")),refetchInterval:3e4}),a=g({queryKey:p.funding.exposure(),queryFn:()=>D().then(s=>y(M,s,"Exposure aggregate")),refetchInterval:3e4}),r=g({queryKey:p.funding.pnl(),queryFn:()=>E().then(s=>y(P,s,"PnL snapshot")),refetchInterval:3e4}),x=q.useMemo(()=>a.data?Object.entries(a.data.by_symbol).map(([s,n])=>{const[c,u="UNKNOWN"]=s.split(".");return{key:s,symbol:c,venue:u,qty:n.qty_base,price:n.last_price_usd,exposure:n.exposure_usd}}).sort((s,n)=>Math.abs(n.exposure)-Math.abs(s.exposure)).slice(0,12):[],[a.data]),d=q.useMemo(()=>{if(!r.data)return[];const s=new Set([...Object.keys(r.data.realized),...Object.keys(r.data.unrealized)]);return Array.from(s).map(n=>{const c=r.data.realized[n]??0,u=r.data.unrealized[n]??0;return{venue:n,realized:c,unrealized:u,total:c+u}}).sort((n,c)=>Math.abs(c.total)-Math.abs(n.total))},[r.data]),m=t.isLoading||a.isLoading||r.isLoading;return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-3",children:[e.jsx(f,{title:"Total Equity",description:"Aggregate across all venues",icon:e.jsx(Q,{className:"h-4 w-4 text-emerald-400"}),value:t.data?o(t.data.equity_usd):"—",footer:t.data?`Return: ${U(t.data.return_pct)}`:"Return: —",loading:t.isLoading}),e.jsx(f,{title:"Cash on Hand",description:"Liquid capital available",icon:e.jsx(K,{className:"h-4 w-4 text-cyan-400"}),value:t.data?o(t.data.cash_usd):"—",footer:t.data?`Gain/Loss: ${o(t.data.gain_usd)}`:"Gain/Loss: —",loading:t.isLoading}),e.jsx(f,{title:"Tracked Symbols",description:"Positions & watchlist coverage",icon:e.jsx($,{className:"h-4 w-4 text-violet-400"}),value:a.data?a.data.totals.count.toString():"—",footer:a.data?`Exposure: ${o(a.data.totals.exposure_usd,{maximumFractionDigits:0,minimumFractionDigits:0})}`:"Exposure: —",loading:a.isLoading})]}),e.jsxs(b,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Symbol Exposure"}),e.jsx(z,{children:"Top positions by notional exposure (USD)"})]}),e.jsxs(j,{variant:"outline",children:["Last refresh: ",I(t.data?.last_refresh_epoch)]})]}),e.jsx(L,{children:m?e.jsx(S,{className:"h-40 w-full"}):x.length===0?e.jsx(k,{message:"No exposure data available yet. Once positions are reported by the engines they will appear here."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(C,{children:e.jsxs(h,{children:[e.jsx(i,{children:"Symbol"}),e.jsx(i,{children:"Venue"}),e.jsx(i,{className:"text-right",children:"Quantity"}),e.jsx(i,{className:"text-right",children:"Last Price"}),e.jsx(i,{className:"text-right",children:"Exposure"})]})}),e.jsx(F,{children:x.map(s=>e.jsxs(h,{children:[e.jsx(l,{children:s.symbol}),e.jsx(l,{children:e.jsx(j,{variant:"secondary",children:s.venue})}),e.jsx(l,{className:"text-right font-mono",children:s.qty.toFixed(6)}),e.jsx(l,{className:"text-right font-mono",children:o(s.price)}),e.jsx(l,{className:"text-right font-mono",children:o(s.exposure,{maximumFractionDigits:0,minimumFractionDigits:0})})]},s.key))})]})})})]}),e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(v,{children:"Venue PnL Snapshot"}),e.jsx(z,{children:"Realized vs unrealized performance by venue"})]}),e.jsx(L,{children:r.isLoading?e.jsx(S,{className:"h-32 w-full"}):d.length===0?e.jsx(k,{message:"PnL data is not available yet. Populate the collectors or run the engines to see live figures."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(C,{children:e.jsxs(h,{children:[e.jsx(i,{children:"Venue"}),e.jsx(i,{className:"text-right",children:"Realized"}),e.jsx(i,{className:"text-right",children:"Unrealized"}),e.jsx(i,{className:"text-right",children:"Total"})]})}),e.jsx(F,{children:d.map(s=>{const n=s.total>=0;return e.jsxs(h,{children:[e.jsx(l,{children:e.jsx(j,{variant:"outline",children:s.venue})}),e.jsx(l,{className:"text-right font-mono",children:o(s.realized)}),e.jsx(l,{className:"text-right font-mono",children:o(s.unrealized)}),e.jsx(l,{className:`text-right font-mono ${n?"text-emerald-400":"text-rose-400"}`,children:o(s.total)})]},s.venue)})})]})})})]})]})}function f({title:t,description:a,value:r,icon:x,footer:d,loading:m}){return e.jsxs(b,{className:"bg-zinc-900/40 border-zinc-800",children:[e.jsxs(N,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-sm text-zinc-200",children:t}),e.jsx(z,{children:a})]}),e.jsx("div",{className:"rounded-full border border-zinc-700/50 bg-zinc-900/70 p-2",children:x})]}),e.jsxs(L,{children:[m?e.jsx(S,{className:"h-8 w-36"}):e.jsx("div",{className:"text-2xl font-semibold text-zinc-100",children:r}),d?e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:d}):null]})]})}function k({message:t}){return e.jsx("div",{className:"flex min-h-[120px] items-center justify-center rounded-lg border border-dashed border-zinc-800 bg-zinc-900/40 px-4 text-sm text-zinc-500",children:t})}export{W as FundingTab};
