import{c as F,N as G,F as D,m as y,r as m,j as e,C as k,O as z,Q as S,R as C,B as W,K as b,J,T,S as w,U as X,q as p,V as Y,W as Z,X as ee,Y as te}from"./index-Rk7jxlAW.js";import{u as se}from"./useMutation-BqS71wKq.js";import{B as P}from"./badge-DbHrsCMU.js";import{T as Q,a as U,b as v,c,d as H,e as l}from"./table--BgB20oK.js";import{v as N,b as ae,e as ne,c as re,f as ie}from"./validation-COF01_rP.js";import{I as oe}from"./input-DrLZrDxf.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],le=F("chart-no-axes-column",ce);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ue=F("dollar-sign",de);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],me=F("save",xe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],pe=F("trending-up",he);function d(r,u={}){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2,minimumFractionDigits:2,...u}).format(r)}function ge(r){return`${(r*100).toFixed(2)}%`}function je(r){return r?new Date(r*1e3).toLocaleString():"—"}function ze(){const r=G(),u=D(t=>t.opsAuth.token),_=D(t=>t.opsAuth.actor),g=D(t=>t.opsAuth.approver),a=y({queryKey:p.funding.portfolio(),queryFn:()=>Y().then(t=>N(ae,t,"Aggregate portfolio")),refetchInterval:3e4}),i=y({queryKey:p.funding.exposure(),queryFn:()=>Z().then(t=>N(ne,t,"Exposure aggregate")),refetchInterval:3e4}),x=y({queryKey:p.funding.pnl(),queryFn:()=>ee().then(t=>N(re,t,"PnL snapshot")),refetchInterval:3e4}),j=y({queryKey:p.settings.config(),queryFn:()=>te().then(t=>N(ie,t,"Runtime config")),staleTime:6e4}),[f,q]=m.useState({}),[L,O]=m.useState(!1);m.useEffect(()=>{if(!j.data||L)return;const t=j.data.effective?.buckets??{},s=Object.entries(t).reduce((n,[o,h])=>(n[o]=typeof h=="number"?h:Number(h??0),n),{});q(s)},[j.data,L]);const E=se({mutationFn:async({buckets:t,options:s})=>X({buckets:t},s),onSuccess:t=>{b.success("Capital buckets updated"),O(!1);const s=t.effective?.buckets??{},n=Object.entries(s).reduce((o,[h,M])=>(o[h]=typeof M=="number"?M:Number(M??0),o),{});q(n),r.setQueryData(p.settings.config(),t)},onError:t=>{b.error("Failed to update capital buckets",{description:t instanceof Error?t.message:"Unknown error"})}}),$=(t,s)=>{O(!0),q(n=>({...n,[t]:s}))},A=m.useMemo(()=>Object.values(f).reduce((t,s)=>t+(Number(s)||0),0),[f]),R=m.useMemo(()=>i.data?Object.entries(i.data.by_symbol).map(([t,s])=>{const[n,o="UNKNOWN"]=t.split(".");return{key:t,symbol:n,venue:o,qty:s.qty_base,price:s.last_price_usd,exposure:s.exposure_usd}}).sort((t,s)=>Math.abs(s.exposure)-Math.abs(t.exposure)).slice(0,12):[],[i.data]),K=m.useMemo(()=>{if(!x.data)return[];const t=new Set([...Object.keys(x.data.realized),...Object.keys(x.data.unrealized)]);return Array.from(t).map(s=>{const n=x.data.realized[s]??0,o=x.data.unrealized[s]??0;return{venue:s,realized:n,unrealized:o,total:n+o}}).sort((s,n)=>Math.abs(n.total)-Math.abs(s.total))},[x.data]),V=a.isLoading||i.isLoading||x.isLoading;return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs(k,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Capital Buckets"}),e.jsx(C,{children:"Update allocation weights used by the allocator. Values must sum to 1.0."})]}),e.jsxs(W,{variant:"secondary",size:"sm",disabled:E.isPending||!L||!u.trim()||Math.abs(A-1)>.001,onClick:()=>{if(!u.trim()){b.error("Provide an OPS token in Settings before updating buckets");return}if(!g.trim()){b.error("Provide an approver token before updating capital buckets");return}E.mutate({buckets:f,options:{token:u.trim(),actor:_.trim()||void 0,approverToken:g.trim()||void 0,idempotencyKey:J("buckets")}})},children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),E.isPending?"Saving…":"Save allocations"]})]}),e.jsx(T,{children:j.isLoading?e.jsx(w,{className:"h-32 w-full"}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Object.entries(f).map(([t,s])=>e.jsxs("div",{className:"rounded-lg border border-zinc-800/60 bg-zinc-950/40 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-medium text-zinc-200",children:[e.jsx("span",{children:t}),e.jsxs("span",{children:[(s*100).toFixed(1),"%"]})]}),e.jsx(oe,{type:"number",min:0,max:1,step:.01,value:Number.isFinite(s)?s:0,onChange:n=>$(t,Number(n.target.value))})]},t))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-zinc-500",children:[e.jsx("span",{children:"Total allocation"}),e.jsx("span",{className:Math.abs(A-1)<=.001?"text-emerald-400":"text-amber-400",children:A.toFixed(3)})]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-3",children:[e.jsx(B,{title:"Total Equity",description:"Aggregate across all venues",icon:e.jsx(pe,{className:"h-4 w-4 text-emerald-400"}),value:a.data?d(a.data.equity_usd):"—",footer:a.data?`Return: ${ge(a.data.return_pct)}`:"Return: —",loading:a.isLoading}),e.jsx(B,{title:"Cash on Hand",description:"Liquid capital available",icon:e.jsx(ue,{className:"h-4 w-4 text-cyan-400"}),value:a.data?d(a.data.cash_usd):"—",footer:a.data?`Gain/Loss: ${d(a.data.gain_usd)}`:"Gain/Loss: —",loading:a.isLoading}),e.jsx(B,{title:"Tracked Symbols",description:"Positions & watchlist coverage",icon:e.jsx(le,{className:"h-4 w-4 text-violet-400"}),value:i.data?i.data.totals.count.toString():"—",footer:i.data?`Exposure: ${d(i.data.totals.exposure_usd,{maximumFractionDigits:0,minimumFractionDigits:0})}`:"Exposure: —",loading:i.isLoading})]}),e.jsxs(k,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Symbol Exposure"}),e.jsx(C,{children:"Top positions by notional exposure (USD)"})]}),e.jsxs(P,{variant:"outline",children:["Last refresh: ",je(a.data?.last_refresh_epoch)]})]}),e.jsx(T,{children:V?e.jsx(w,{className:"h-40 w-full"}):R.length===0?e.jsx(I,{message:"No exposure data available yet. Once positions are reported by the engines they will appear here."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(U,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Venue"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{className:"text-right",children:"Last Price"}),e.jsx(c,{className:"text-right",children:"Exposure"})]})}),e.jsx(H,{children:R.map(t=>e.jsxs(v,{children:[e.jsx(l,{children:t.symbol}),e.jsx(l,{children:e.jsx(P,{variant:"secondary",children:t.venue})}),e.jsx(l,{className:"text-right font-mono",children:t.qty.toFixed(6)}),e.jsx(l,{className:"text-right font-mono",children:d(t.price)}),e.jsx(l,{className:"text-right font-mono",children:d(t.exposure,{maximumFractionDigits:0,minimumFractionDigits:0})})]},t.key))})]})})})]}),e.jsxs(k,{children:[e.jsxs(z,{children:[e.jsx(S,{children:"Venue PnL Snapshot"}),e.jsx(C,{children:"Realized vs unrealized performance by venue"})]}),e.jsx(T,{children:x.isLoading?e.jsx(w,{className:"h-32 w-full"}):K.length===0?e.jsx(I,{message:"PnL data is not available yet. Populate the collectors or run the engines to see live figures."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(U,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Venue"}),e.jsx(c,{className:"text-right",children:"Realized"}),e.jsx(c,{className:"text-right",children:"Unrealized"}),e.jsx(c,{className:"text-right",children:"Total"})]})}),e.jsx(H,{children:K.map(t=>{const s=t.total>=0;return e.jsxs(v,{children:[e.jsx(l,{children:e.jsx(P,{variant:"outline",children:t.venue})}),e.jsx(l,{className:"text-right font-mono",children:d(t.realized)}),e.jsx(l,{className:"text-right font-mono",children:d(t.unrealized)}),e.jsx(l,{className:`text-right font-mono ${s?"text-emerald-400":"text-rose-400"}`,children:d(t.total)})]},t.venue)})})]})})})]})]})}function B({title:r,description:u,value:_,icon:g,footer:a,loading:i}){return e.jsxs(k,{className:"bg-zinc-900/40 border-zinc-800",children:[e.jsxs(z,{className:"flex flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-sm text-zinc-200",children:r}),e.jsx(C,{children:u})]}),e.jsx("div",{className:"rounded-full border border-zinc-700/50 bg-zinc-900/70 p-2",children:g})]}),e.jsxs(T,{children:[i?e.jsx(w,{className:"h-8 w-36"}):e.jsx("div",{className:"text-2xl font-semibold text-zinc-100",children:_}),a?e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:a}):null]})]})}function I({message:r}){return e.jsx("div",{className:"flex min-h-[120px] items-center justify-center rounded-lg border border-dashed border-zinc-800 bg-zinc-900/40 px-4 text-sm text-zinc-500",children:r})}export{ze as FundingTab};
//# sourceMappingURL=FundingTab-BUkQH1me.js.map
