<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HMM Command Center v2</title>
    <style>
      :root { --bg:#0b0b0f; --panel:#14161a; --muted:#6b7280; --text:#e5e7eb; --brand:#22d3ee; --ok:#34d399; --bad:#f87171; --border:#23262b; }
      *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
      .wrap{max-width:1120px;margin:28px auto;padding:0 16px}
      .row{display:grid;gap:16px}.row.g3{grid-template-columns:repeat(3,minmax(0,1fr))}.row.g2{grid-template-columns:repeat(2,minmax(0,1fr))}
      .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)); border:1px solid var(--border); border-radius:16px; padding:16px}
      .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
      .h1{font-weight:800;font-size:22px;letter-spacing:-0.02em}.muted{color:var(--muted)}.pill{border:1px solid var(--border);padding:3px 8px;border-radius:999px;margin-left:6px}
      .btn{background:#2563eb;border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}.btn.bad{background:#dc2626}.btn.ok{background:#059669}
      .grid6{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px}.stat{background:#0f1115;border:1px solid var(--border);border-radius:10px;padding:10px}
      .label{font-size:11px;color:var(--muted)} .value{font-size:16px;font-weight:700}.spark{width:100%;height:36px}.thumb{border:1px solid var(--border);border-radius:10px;padding:8px;background:#0f1115;font-size:12px;color:var(--muted)}
      .feed{max-height:200px;overflow-y:auto;padding:0;margin:12px 0;list-style:none}
      .feed li{padding:6px 0;border-bottom:1px solid var(--border);font-size:12px}
      .feed li:first-child{font-weight:600;color:var(--text)}
      /* T4: Guardrail color rules */
      .bad-outline { border: 2px solid #f87171 !important; }
      .good-bg { background: linear-gradient(90deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05)) !important; }
      .warn-bg { background: linear-gradient(90deg, rgba(251, 191, 36, 0.1), rgba(251, 191, 36, 0.05)) !important; }
      ._body { max-height: 300px; overflow-y: auto; }
      div.row { display: grid; grid-template-columns: 1fr 0.5fr 1fr 1fr 1fr 1fr; gap: 8px; padding: 4px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
      div.row.head { font-weight: 700; color: var(--text); }
      div.row.rowline { border-bottom: 1px solid rgba(255,255,255,.05); }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="head">
        <div><div class="h1">HMM Command Center v2</div><div class="muted">Live Ops • Metrics • Lineage • Guardrails</div></div>
        <div>
          <span id="mode-badge" class="pill muted">mode: …</span>
          <div id="ws-indicators" class="muted"></div>
        </div>
      </div>

      <div class="card">
        <div class="head"><div><b>Live Strip</b></div><div id="msg" class="muted"></div></div>
        <div id="live-strip" class="grid6"></div>
      </div>

      <div style="margin:12px 0; display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn bad" onclick="ctrl('kill')">Kill</button>
        <button class="btn" onclick="ctrl('retrain')">Retrain</button>
        <button class="btn ok" onclick="ctrl('canary_promote',{target_tag:'latest'})">Promote</button>
      </div>

      <div class="row g3">
        <div class="card"><div class="head"><b>PnL & Exposure</b><span class="muted">spark</span></div>
          <div class="row g3" id="pnl-stats"></div>
          <svg class="spark" viewBox="0 0 120 36"><path id="spark-path" d="" fill="none" stroke="#9ca3af" stroke-width="2"/></svg>
        </div>
        <div class="card"><div class="head"><b>Scheduler (M19)</b></div><ul id="feed-scheduler" class="feed"></ul></div>
        <div class="card" id="card-guardian-feed">
          <div class="head"><div class="h1">Guardian Feed</div></div>
          <div id="guardian-body" class="_body"></div>
        </div>
        <div class="card"><div class="head"><b>Policy Confidence</b></div><div class="row g3" id="policy-stats"></div></div>
        <div class="card"><div class="head"><b>Lineage (M21)</b></div><div id="lineage"></div></div>
        <div class="card"><div class="head"><b>Calibration Gallery (M15)</b></div><div id="gallery" class="row g3"></div></div>
        <div class="card" id="card-positions">
          <div class="head"><div class="h1">Positions (M22)</div></div>
          <div id="positions-body" class="_body"></div>
        </div>
      </div>

      <div class="muted" style="margin-top:14px" id="endpoints"></div>
    </div>
    <script src="/static/app.js"></script>
  </body>
</html>
